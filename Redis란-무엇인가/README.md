# Redis란 무엇인가

## 메모리 계층 구조

- 레지스터는 CPU와 동일한 레벨에 위치하고 데이터 처리 속도가 매우 빠르지만 용량이 매우 작다.
- 캐시는 자주 이용하는 데이터를 미리 복사 해놓는 임시 메모리 공간이다.
- 캐시는 처리 속도가 빠른 장치와 느린 장치간의 속도 차이로 인한 병목 현상을 줄이기 위해 사용한다.
- CPU와 RAM간에는 속도 편차가 심해 중간에 캐시를 둬서 속도 편차 문제를 해소한다.
- CPU가 특정 데이터를 필요로 할 때 캐시에 들러 탐색을 하고 없으면 RAM에 접근해 가져온다.
- 레지스터와 캐시는 저장공간 대비 고비용이여서 RAM이 주기억장치로서의 역할을 수행한다.
- 주기억장치(RAM)는 CPU와 가까워 데이터 처리 속도가 빠르나 전원이 꺼지면 데이터가 사라진다.
- 보조기억장치(HDD, SSD)는 RAM보다 처리 속도가 느리지만 전원이 꺼져도 데이터가 유지된다.
- 데이터 입력 => RAM에 저장 => CPU에서 계산 => 계산 결과 다시 RAM에 저장 => 데이터 출력

## In-Memory DB

- 인메모리 DB는 데이터를 메모리 같은 주기억장치에 저장한다.
- 인메모리 DB는 NoSQL에 속하는 데이터베이스로 Key-Value 형식으로 데이터를 저장한다.
- 인메모리 DB는 메모리의 특성 때문에 저장된 데이터는 휘발성이며, I/O 속도가 빠르다.
- 인메모리 DB는 실시간으로 빠른 데이터 I/O 처리를 목적으로 사용한다.
- 대표적인 인메모리 DB로 Redis가 있다.

## Redis

- Redis는 Key-Value 구조로 값을 관리하는 인메모리 DB다.
- Redis는 거대한 Map 구조의 데이터 저장소(Key-Value Store)다.
- Redis는 평균 읽기 및 쓰기 연산 속도가 1ms미만으로 초당 수백만건을 처리 가능하다. RDB 대비 처리 속도가 매우 빠르다.
- Redis는 데이터 영쇽성 보장을 위해 스냅샷 및 AOF 메커니즘을 지원한다.
- Redis는 읽기 분산 처리를 위해 마스터-슬레이브 구조를 지원한다.
- Redis는 쓰기 분산 처리를 위해 샤딩 기능을 지원한다.
- Redis는 요구사항에 따라 여러 아키텍처 구조를 지원한다.
- Redis는 싱글 쓰레드로 동작한다.
- Redis는 서버 한대에 여러 서버를 띄워서 동작이 가능하다.
- 서비스 요구 사항 중 회원 정보 및 결제 정보와 같이 영속성을 중요시 하는 데이터는 RDB를 활용한다.
- 서비스 요구 사항 중 데이터 I/O 처리 속도가 중요한 데이터는 NoSQL을 사용한다.

## Redis RDB(스냅샷)

- 레디스 서버는 메모리 데이터를 디스크에 저장할 수 있다.
- RDB처럼 특정 시점의 데이터를 스냅샷 파일러 떠서 디스크에 저장해 장애를 대비 가능하다.
- 레디스 서버가 재기동하면 디스크에 저장된 스냅샷 파일을 로드해 메모리 데이터를 복구한다.

## Redis AOF(Append-Only File)

- 레디스 서버에서 실행된 읽기 및 쓰기 명령 연산을 로그 형태 파일(AOF)로 기록하여 디스크에 저장한다.
- 레디스 서버가 재기동할 경우 AOF 파일을 로드해서 기록된 명령을 순차적으로 실행하여 데이터를 복구한다.
- AOF는 스냅샷 방식 대비 높은 데이터 신뢰성을 보장하나 많은 디스크 공간을 요구한다.

## Redis 샤딩(Sharding)

- 샤딩은 전체 데이터를 여러 개의 샤드 단위로 저장하고 관리하는 기술을 말한다.
- 샤드 단위로 데이터를 분리한 뒤, 여러 서버에 분배하여 클러스터 구조를 형성하면 데이터 분산 저장 및 분산 처리가 가능하다.

## Redis 아키텍처 : 마스터-슬레이브

- 요약 : Half HA
- 레디스는 마스터-슬레이브 구조를 통해 읽기 작업을 분산 처리하여 성능을 개선할 수 있다.
- 마스터 노드 : 데이터를 쓰고 관리하는 주 서버.
- 슬레이브 노드 : 마스터 서버로부터 데이터를 복제받아 읽기 작업을 분산 처리하는 보조 서버.
- 슬레이브 노드는 처음 연결 시, 마스터 서버의 전체 데이터를 스냅샷 형태로 복제받는다. 이를 통해 마스터 노드와 슬레이브 노드는 동일한 데이터를 보유한다.
- 마스터 노드에서 쓰기 작업(데이터 추가/수정/삭제)이 일어날 경우 슬레이브 노드는 이를 비동기적으로 업데이트 받는다.
- 비동기적 동기화 특성 때문에 운영 중 네트워크 장애가 발생하면, 데이터 일관성을 유지하기 어렵다는 문제가 존재한다.
- 마스터 노드에서 장애가 일어나면 Sentinal이나 별도의 Failover 도구로 슬레이브를 마스터로 승격시켜 주어야 서비스가 정상화 된다.

## Redis 아키텍처 : 마스터-슬레이브 + 센티널

- 요약 : 고가용성HA
- 마스터-슬레이브 구성에 센티널 접목시켜 무중단 서비스를 구현한다.
- 레디스 센티널은 마스터 서버를 감시하다가 다운되면 슬레이브 서버 중 하나를 마스터로 승격시킨다.
- 레디스 센티널은 서버 내에서 레디스 프로세스와 분리된 독립 프로세스 및 포트를 통해 동작한다.
- 레디스 센티널은 데이터 처리 작업을 수행하지 않으며, 오직 모니터링, Failover, 구성 정보 제공만을 담당한다.
- 레디스 센티널은 고가용성(HA) 및 Failover를 지원하지만 데이터 분산(Sharding) 문제를 해결하지는 못한다.
- 레디스 센티널 설정을 통해서 슬레이브 복제 상태를 엄격하게 관리할 수 있다.

## Redis 아키텍처 : 클러스터

- 요약 : 고가용성(HA) + 데이터 분산
- 레디스 클러스터 구조는 데이터를 작은 조각(샤드)으로 나누고, 각 샤드를 서로 다른 서버에 분배해서 저장한다.
- 레디스 클러스터 구조는 각 샤드마다 마스터-슬레이브 + 센티널 구조를 설정하여 무중단 서비스를 구현한다.
- 각 레디스 서버는 자신에게 할당된 샤드의 데이터만 담당하고 다른 서버의 샤드는 처리하지 않는다.
- 데이터를 여러 서버에 분산 저장함으로서, 한 서버에 대한 부담을 줄이고 성능을 높일 수 있다.

## Redis가 사용되는 사례

- 캐싱 : 자주 요청되는 데이터를 캐싱하여 빠른 작업 처리 용이.
- 분산 락(Distributed Locking) : 여러 작업이 동시에 리소스 사용하는 환경에서 동시성 제어 용이.
- 작업 큐 : 대기열.
- 실시간 데이터 처리 : 채팅, 실시간 대시보드, 뷰 수, 좋아요 수.
- 메시지 브로커 : Pub/Sub 기능을 활용해 메시지 전달 용이.
- 랭킹 시스템 : Sorted Set 활용해 순위 데이터 관리 용이.
- 세션 관리
- 지리 데이터 처리 : Geo 기능을 활용해 지리 데이터 처리 용이.